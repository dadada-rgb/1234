-- === Paywall Loader ===
local MarketplaceService = game:GetService("MarketplaceService")
local Players = game:GetService("Players")
local StarterGui = game:GetService("StarterGui")
local LocalPlayer = Players.LocalPlayer

-- Your GamePass
local GamePassId = 1404147326
local PurchaseURL = "https://www.roblox.com/game-pass/1404147326/unlockscript"

-- Core script URL (chỉ load khi user hợp lệ)
local CORE_URL = "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/VhuyHub"

-- Exception username (bypass)
local ExceptionUser = "vu_depzai123ne"

-- Helpers
local function ownsPass()
    local ok, has = pcall(function()
        return MarketplaceService:UserOwnsGamePassAsync(LocalPlayer.UserId, GamePassId)
    end)
    return ok and has
end

local function notify(t, m, d)
    StarterGui:SetCore("SendNotification", {
        Title = t,
        Text = m,
        Duration = d or 5
    })
end

-- === Bypass if exception user ===
if LocalPlayer.Name == ExceptionUser then
    notify("Unlock", "Bypass granted for "..ExceptionUser, 5)
    local src = game:HttpGet(CORE_URL)
    local fn = loadstring(src)
    if fn then fn() end
    return
end

-- === Normal check ===
if not ownsPass() then
    local gui = Instance.new("ScreenGui")
    gui.ResetOnSpawn = false
    gui.IgnoreGuiInset = true
    gui.Name = "UnlockUI"
    gui.Parent = LocalPlayer:WaitForChild("PlayerGui")

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 260, 0, 140)
    frame.Position = UDim2.new(0.5, -130, 0.5, -70)
    frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    frame.Parent = gui
    Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 10)

    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 30)
    title.Position = UDim2.new(0, 0, 0, 10)
    title.BackgroundTransparency = 1
    title.Text = "Unlock Script"
    title.Font = Enum.Font.GothamBold
    title.TextSize = 20
    title.TextColor3 = Color3.new(1, 1, 1)
    title.Parent = frame

    local unlockBtn = Instance.new("TextButton")
    unlockBtn.Size = UDim2.new(1, -40, 0, 36)
    unlockBtn.Position = UDim2.new(0, 20, 0, 50)
    unlockBtn.BackgroundColor3 = Color3.fromRGB(255, 200, 100)
    unlockBtn.Text = "Unlock (Copy Link)"
    unlockBtn.Font = Enum.Font.GothamBold
    unlockBtn.TextSize = 14
    unlockBtn.TextColor3 = Color3.new(0, 0, 0)
    unlockBtn.Parent = frame
    Instance.new("UICorner", unlockBtn).CornerRadius = UDim.new(0, 6)

    local recheckBtn = Instance.new("TextButton")
    recheckBtn.Size = UDim2.new(1, -40, 0, 32)
    recheckBtn.Position = UDim2.new(0, 20, 0, 95)
    recheckBtn.BackgroundColor3 = Color3.fromRGB(150, 255, 150)
    recheckBtn.Text = "Re-check Purchase"
    recheckBtn.Font = Enum.Font.GothamBold
    recheckBtn.TextSize = 14
    recheckBtn.TextColor3 = Color3.new(0, 0, 0)
    recheckBtn.Parent = frame
    Instance.new("UICorner", recheckBtn).CornerRadius = UDim.new(0, 6)

    unlockBtn.MouseButton1Click:Connect(function()
        if setclipboard then
            setclipboard(PurchaseURL)
            notify("Unlock", "Purchase link copied to clipboard!", 5)
        else
            notify("Unlock", "Executor does not support clipboard. Open link manually.", 6)
        end
    end)

    recheckBtn.MouseButton1Click:Connect(function()
        if ownsPass() then
            notify("Unlock", "Game Pass verified! Script unlocked.", 5)
            gui:Destroy()
            local src = game:HttpGet(CORE_URL)
            local fn = loadstring(src)
            if fn then fn() end
        else
            notify("Unlock", "You do not own the Game Pass yet.", 5)
        end
    end)

    return -- stop loader until unlocked
end

-- === Already owns the GamePass, load script directly ===
local src = game:HttpGet(CORE_URL)
local fn = loadstring(src)
if fn then fn() end